<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2018-02-28 17:16:29 -0600">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="/revbayes_tutorials/assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="/revbayes_tutorials/assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="/revbayes_tutorials/assets/css/tutorial.css" />
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
    <title>RevBayes Tutorials: Working With Pandas DataFrames in Python</title>
  </head>
  <body>
    <div class="container">
      <nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a href="https://revbayes.github.io" class="pull-left">
        <img class="navbar-logo" src="/revbayes_tutorials/assets/img/aquabayes.png" alt="RevBayes logo" />
      </a>
      
      
      <a class="navbar-brand" href="/revbayes_tutorials/">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="/revbayes_tutorials/setup/">Setup</a></li>
        <li class="dropdown">
          <a href="/revbayes_tutorials/" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tutorials <span class="caret"></span></a>
          

  <ul class="dropdown-menu">




  <li class="dropdown-header">Basic</li>
  
    <li><a href="/revbayes_tutorials/tutorials/intro/">Getting Started</a></li>
  



  

  

  
    
    
      <li class="dropdown-header">Data</li>
      
        <li><a href="/revbayes_tutorials/tutorials/datatypes/">Introduction to Python Datatypes and Packages</a></li>
      
    
  



  
  
    <li class="dropdown-header">Other</li>
    
      <li><a href="/revbayes_tutorials/tutorials/more-dataframes/">Indexing, Slicing, and Subsetting DataFrames in Python</a></li>
    
      <li><a href="/revbayes_tutorials/tutorials/starting-with-data/">Working With Pandas DataFrames in Python</a></li>
    
  



  </ul>

        </li>
        <li><a href="/revbayes_tutorials/reference/">Reference</a></li>

	
        <li><a href="/revbayes_tutorials/license/">License</a></li>
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>









  

  

  
    
    
  



  
  






<div class="row">
  <div class="col-md-1 no-print">
    <h3>
      
      <a href="/revbayes_tutorials/tutorials/more-dataframes/"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous tutorial</span></a>
      
    </h3>
  </div>
  <div class="col-md-10">
    
    <h1 class="maintitle">Working With Pandas DataFrames in Python</h1>
    <h3 class="subtitle"></h3>
    <h3 class="maintitle"></h3>
    
  </div>
  <div class="col-md-1 no-print">
    <h3>
      
      <a href="/revbayes_tutorials/"><span class="glyphicon glyphicon-menu-up" aria-hidden="true"></span><span class="sr-only">tutorials home</span></a>
      
    </h3>
  </div>
</div>


<blockquote class="overview" id="overview">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-9">
        <strong>Prerequisites</strong>
        <ul>
        
          <li>None</li>
        
        </ul>
    </div>
  </div>
</blockquote>

<blockquote class="tutorial_files">
  <h2>Data files and scripts</h2>
  
</blockquote>
<h1 id="starting-with-data">Starting with Data</h1>

<p>We can automate much of our research workflow using Python. It’s efficient to spend time
building the code to perform these tasks because once it is built, we can use it
over and over on different datasets that use a similar format. This makes our
methods easy to reproduce and easy to adapt to new projects. We can also share our code with colleagues
and they can replicate the same analysis.</p>

<h3 id="getting-set-up">Getting Set Up</h3>

<p>To help the lesson run smoothly, let’s ensure everyone is in the same directory.
This should help us avoid path and file name issues. At this time please
navigate to the <code class="highlighter-rouge">python-bcb546</code> directory on your computer. If you working in Jupyter Notebook be sure
that you start your notebook in the <code class="highlighter-rouge">python-bcb546</code> directory. If you do not have this directory, please see the instructions in the <a href="../setup/">Setup</a> page.</p>

<p>You will want to use a Jupyter notebook or the Spyder IDE console to run this lesson. Both of these tools make it easy to view in-line plots.</p>

<p>To start a new Python session in a Jupyter notebook:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd python-bcb546
$ jupyter notebook
</code></pre></div></div>

<p>Then select <strong><em>New-&gt;Python 3</em></strong>. Name this session <code class="highlighter-rouge">03-starting-wtih-data</code>.</p>

<p>Alternatively, you can start a Spyder instance and navigate to the <code class="highlighter-rouge">python-bcb546</code> directory from the console using Unix commands.</p>

<h3 id="our-data">Our Data</h3>

<p>For this lesson, we will be using the Portal Teaching data, a subset of the data
from the ecological study by Ernst et al. (2009):
<a href="http://www.esapubs.org/archive/ecol/E090/118/default.htm">Long-term monitoring and experimental manipulation of a Chihuahuan Desert ecosystem near Portal, Arizona, USA</a>
Specifically, we will be using files from the <a href="https://figshare.com/articles/Portal_Project_Teaching_Database/1314459">Portal Project Teaching Database</a>.</p>

<ul>
  <li>This section will use the <code class="highlighter-rouge">surveys.csv</code> file that can be downloaded from the 
<a href="https://github.com/EEOB-BioData/BCB546X-Fall2017/tree/master/python-bcb546"><code class="highlighter-rouge">python-bcb546</code></a> folder of the course repository.
Pull from the course repository and change to to <code class="highlighter-rouge">python-bcb546</code> or copy the <code class="highlighter-rouge">surveys.csv</code> file to the directory from which you would like to work.</li>
</ul>

<p>In this lesson, we are studying the species and weight of (<em>vertebrate</em>) animals captured in plots in our study
area. The observed data are stored as a <code class="highlighter-rouge">.csv</code> file (comma-separated value): each row holds information for a
single animal, and the columns represent:</p>

<table>
  <thead>
    <tr>
      <th>Column</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>record_id</td>
      <td>Unique id for the observation</td>
    </tr>
    <tr>
      <td>month</td>
      <td>month of observation</td>
    </tr>
    <tr>
      <td>day</td>
      <td>day of observation</td>
    </tr>
    <tr>
      <td>year</td>
      <td>year of observation</td>
    </tr>
    <tr>
      <td>plot_id</td>
      <td>ID of a particular plot</td>
    </tr>
    <tr>
      <td>species_id</td>
      <td>2-letter code</td>
    </tr>
    <tr>
      <td>sex</td>
      <td>sex of animal (“M”, “F”)</td>
    </tr>
    <tr>
      <td>hindfoot_length</td>
      <td>length of the hindfoot in mm</td>
    </tr>
    <tr>
      <td>weight</td>
      <td>weight of the animal in grams</td>
    </tr>
  </tbody>
</table>

<p>The first few rows of our first file look like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>record_id,month,day,year,plot_id,species_id,sex,hindfoot_length,weight
1,7,16,1977,2,NL,M,32,
2,7,16,1977,3,NL,M,33,
3,7,16,1977,2,DM,F,37,
4,7,16,1977,7,DM,M,36,
5,7,16,1977,3,DM,M,35,
6,7,16,1977,1,PF,M,14,
7,7,16,1977,2,PE,F,,
8,7,16,1977,1,DM,M,37,
9,7,16,1977,1,DM,F,34,
</code></pre></div></div>

<h2 id="pandas-in-python">Pandas in Python</h2>
<p>One of the best options for working with tabular data in Python is to use the
<a href="http://pandas.pydata.org/">Python Data Analysis Library</a> (a.k.a. Pandas). The
Pandas library provides data structures, produces high quality plots with
<a href="http://matplotlib.org/">matplotlib</a> and integrates nicely with other libraries
that use <a href="http://www.numpy.org/">NumPy</a> (which is another Python library) arrays.</p>

<p>Python does not load all available libraries by default. We have to
add an <code class="highlighter-rouge">import</code> statement to our code in order to use library functions. To import
a library, we use the syntax <code class="highlighter-rouge">import libraryName</code>. If we want to give the
library a nickname to shorten the command, we can add <code class="highlighter-rouge">as myNickName</code>.</p>

<p>Import the pandas library using the common nickname <code class="highlighter-rouge">pd</code> is below.</p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import pandas as pd
</code></pre></div></div>

<p>If you’re using a Jupyter notebook for this lesson, it should look like this:</p>

<p><img src="../fig/03-name-jn.png" alt="Weight by Species Plot" /></p>

<p>Remember that the <code class="highlighter-rouge">import pandas as pd</code> syntax means that we have given the alias <code class="highlighter-rouge">pd</code> to the pandas library. Thus, we don’t have to use the whole name when we invoke pandas functions.</p>

<h1 id="reading-csv-data-using-pandas">Reading CSV Data Using Pandas</h1>

<p>We will begin by locating and reading our survey data which are in CSV format.
We can use Pandas’ <code class="highlighter-rouge">read_csv</code> function to pull the file directly into a
<a href="http://pandas.pydata.org/pandas-docs/stable/dsintro.html#dataframe">DataFrame</a>.</p>

<h2 id="whats-a-dataframe">What’s a DataFrame?</h2>

<p>A DataFrame is a 2-dimensional data structure that can store data of different
types (including characters, integers, floating point values, factors and more)
in columns. It is similar to a spreadsheet or an SQL table or the <code class="highlighter-rouge">data.frame</code> in
R. A DataFrame always has an index (0-based). An index refers to the position of 
an element in the data structure.</p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pd.read_csv("surveys.csv")
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       record_id  month  day  year  plot_id species_id  sex  hindfoot_length  \
0              1      7   16  1977        2         NL    M             32.0   
1              2      7   16  1977        3         NL    M             33.0   
2              3      7   16  1977        2         DM    F             37.0   
3              4      7   16  1977        7         DM    M             36.0   
4              5      7   16  1977        3         DM    M             35.0   
5              6      7   16  1977        1         PF    M             14.0   
6              7      7   16  1977        2         PE    F              NaN   
7              8      7   16  1977        1         DM    M             37.0   
...          ...    ...  ...   ...      ...        ...   ...             ...
35547      35548     12   31  2002        7         DO    M             36.0   
35548      35549     12   31  2002        5        NaN  NaN              NaN   

       weight  
0         NaN  
1         NaN  
2         NaN  
3         NaN  
4         NaN  
5         NaN  
6         NaN  
7         NaN  
...       ...
35547    51.0  
35548     NaN  

[35549 rows x 9 columns]
</code></pre></div></div>

<p>We can see that there were 33,549 rows parsed into a DataFrame. Each row has 9
columns. The first column is the index of the DataFrame. The index is used to
identify the position of the data, but it is not an actual column of the DataFrame (it is not labeled).</p>

<p>It looks like  the <code class="highlighter-rouge">read_csv</code> function in Pandas  read our file properly. However, we haven’t saved any data to memory, and we cannot work with it until we do that.
We need to assign the DataFrame to a variable. 
Remember that a variable is a name for a value, such as <code class="highlighter-rouge">x</code>, 
or  <code class="highlighter-rouge">data</code>. We can create a new object with a variable name by assigning a value to it using the <code class="highlighter-rouge">=</code> operator.</p>

<p>Let’s call the imported survey data <code class="highlighter-rouge">surveys_df</code>:</p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>surveys_df = pd.read_csv("surveys.csv")
</code></pre></div></div>

<p>Notice when you assign the imported DataFrame to a variable, Python does not
produce any output on the screen. We can print the value of the <code class="highlighter-rouge">surveys_df</code>
object by typing its name into the Python command prompt. This will print the data frame just like above.</p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>surveys_df
</code></pre></div></div>

<h2 id="inspecting-our-species-survey-dataframe">Inspecting Our Species Survey DataFrame</h2>

<p>Now we can start working with our data. First, let’s check the data type of the
data stored in <code class="highlighter-rouge">surveys_df</code> using the <code class="highlighter-rouge">type</code> function. The <code class="highlighter-rouge">type</code> function and
<code class="highlighter-rouge">__class__</code> attribute tell us that <code class="highlighter-rouge">surveys_df</code> is <code class="highlighter-rouge">&lt;class 'pandas.core.frame.DataFrame'&gt;</code>.</p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>type(surveys_df)
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pandas.core.frame.DataFrame
</code></pre></div></div>

<p>The output is the same if you use this:</p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>surveys_df.__class__
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pandas.core.frame.DataFrame
</code></pre></div></div>

<p>We can also enter <code class="highlighter-rouge">surveys_df.dtypes</code> at our prompt to view the data type for each
column in our DataFrame. <code class="highlighter-rouge">int64</code> represents numeric integer values - <code class="highlighter-rouge">int64</code> cells
can not store decimals. <code class="highlighter-rouge">object</code> represents strings (letters and numbers). <code class="highlighter-rouge">float64</code>
represents numbers with decimals.</p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>surveys_df.dtypes
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>record_id            int64
month                int64
day                  int64
year                 int64
plot_id              int64
species_id          object
sex                 object
hindfoot_length    float64
weight             float64
dtype: object
</code></pre></div></div>

<h3 id="useful-ways-to-view-dataframe-objects-in-python">Useful Ways to View DataFrame objects in Python</h3>

<p>There are multiple methods that can be used to summarize and access the data
stored in DataFrames. Note that we call the method by using
the object or method name <code class="highlighter-rouge">surveys_df.object</code> or <code class="highlighter-rouge">surveys_df.method()</code>. So <code class="highlighter-rouge">surveys_df.columns</code> provides an index
of all of the column names in our DataFrame.</p>

<blockquote class="callout">
  <h2 id="querying-dataframes">Querying DataFrames</h2>

  <p>There are several methods that allow you to inspect your DataFrame.</p>

  <p>Print the column names:</p>

  <div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>surveys_df.columns
</code></pre></div>  </div>

  <p>Print the <em>first</em> <code class="highlighter-rouge">4</code> lines of the DataFrame</p>

  <div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>surveys_df.head(4)
</code></pre></div>  </div>

  <p>Print the <em>last</em> <code class="highlighter-rouge">4</code> lines of the DataFrame</p>

  <div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>surveys_df.tail(4)
</code></pre></div>  </div>

  <p>Print the shape of the DataFrame</p>

  <div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>surveys_df.shape
</code></pre></div>  </div>
</blockquote>

<h2 id="summarizing-data-in-a-pandas-dataframe">Summarizing Data in a Pandas DataFrame</h2>

<p>We’ve read our data into Python. Next, let’s perform some quick summaries of the DataFrame to learn more about the data that we’re working with. We might want
to know how many animals were collected in each plot, or how many of each
species were caught. We can summarize different aspects of our data using groups. But first we need to figure out what we want to group by.</p>

<p>Let’s begin by exploring our data and view the column names:</p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>surveys_df.columns.values
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array(['record_id', 'month', 'day', 'year', 'plot_id', 'species_id', 'sex',
       'hindfoot_length', 'weight'], dtype=object)
</code></pre></div></div>

<p>Let’s get a list of all the species. The <code class="highlighter-rouge">pd.unique</code> method tells us all of
the unique values in the <code class="highlighter-rouge">species_id</code> column. These are two-character identifiers of the species names (e.g., <code class="highlighter-rouge">NL</code> represents the rodent <a href="https://en.wikipedia.org/wiki/White-throated_woodrat"><em>Neotoma albigula</em></a>).</p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pd.unique(surveys_df['species_id'])
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array(['NL', 'DM', 'PF', 'PE', 'DS', 'PP', 'SH', 'OT', 'DO', 'OX', 'SS',
       'OL', 'RM', nan, 'SA', 'PM', 'AH', 'DX', 'AB', 'CB', 'CM', 'CQ',
       'RF', 'PC', 'PG', 'PH', 'PU', 'CV', 'UR', 'UP', 'ZL', 'UL', 'CS',
       'SC', 'BA', 'SF', 'RO', 'AS', 'SO', 'PI', 'ST', 'CU', 'SU', 'RX',
       'PB', 'PL', 'PX', 'CT', 'US'], dtype=object)
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="how-many-plots-were-recorded-for-this-dataset">How many plots were recorded for this dataset?</h2>

  <ol>
    <li>
      <p>Create a list of unique plot ID’s found in the surveys data. 
Call it <code class="highlighter-rouge">plot_names</code>. How many unique plots are there in the data? 
<!--How many unique species are in the data?--></p>
    </li>
    <li>
      <p>What is a much simpler approach to this?</p>
    </li>
  </ol>

  <blockquote class="solution">
    <h2 id="solution">Solution</h2>

    <div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 1
plot_names = list(pd.unique(surveys_df['plot_id']))
print(len(plot_names))

# 2
print(surveys_df['plot_id'].nunique())
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<h1 id="groups-in-pandas">Groups in Pandas</h1>

<p>We often want to calculate summary statistics grouped by subsets or attributes
within fields of our data. For example, we might want to calculate the average
weight of all individuals per plot.</p>

<p>We can calculate basic statistics for all records in a single column using the
<code class="highlighter-rouge">.describe()</code> method:</p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>surveys_df['weight'].describe()
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>count    32283.000000
mean        42.672428
std         36.631259
min          4.000000
25%         20.000000
50%         37.000000
75%         48.000000
max        280.000000
Name: weight, dtype: float64
</code></pre></div></div>

<p>We can also extract one specific metric if we wish:</p>

<p>Like the lowest <code class="highlighter-rouge">weight</code></p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>surveys_df['weight'].min()
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>4.0
</code></pre></div></div>

<p>The maximum <code class="highlighter-rouge">weight</code></p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>surveys_df['weight'].max()
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>280.0
</code></pre></div></div>

<p>The <code class="highlighter-rouge">mean</code> of the <code class="highlighter-rouge">weight</code> column</p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>surveys_df['weight'].mean()
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>42.672428212991356
</code></pre></div></div>

<p>The standard deviation of the <code class="highlighter-rouge">weight</code></p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>surveys_df['weight'].std()
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>36.63125947458399
</code></pre></div></div>

<p>Count the number of non-null observations made:</p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>surveys_df['weight'].count()
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>32283
</code></pre></div></div>

<p>But if we want to summarize by one or more variables, for example sex, we need to
use the Pandas DataFrame <code class="highlighter-rouge">.groupby()</code> method. Once we’ve created a re-orgaized DataFrame, we
can quickly calculate summary statistics by a group of our choice.</p>

<p>Group data by the sex of each observed individual:</p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sorted_data = surveys_df.groupby('sex')
</code></pre></div></div>

<p>The method <code class="highlighter-rouge">.describe()</code> will return descriptive stats including: mean,
median, max, min, std and count for a particular column in the data. Pandas’
<code class="highlighter-rouge">.describe()</code> method will only return summary values for columns containing
numeric data.
This provides summary statistics for each column separated by sex.</p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sorted_data.describe()
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                    day  hindfoot_length         month       plot_id  \
sex                                                                    
F   count  15690.000000     14894.000000  15690.000000  15690.000000   
    mean      16.007138        28.836780      6.583047     11.440854   
    std        8.271144         9.463789      3.367350      6.870684   
    min        1.000000         7.000000      1.000000      1.000000   
    25%        9.000000        21.000000      4.000000      5.000000   
    50%       16.000000        27.000000      7.000000     12.000000   
    75%       23.000000        36.000000     10.000000     17.000000   
    max       31.000000        64.000000     12.000000     24.000000   
M   count  17348.000000     16476.000000  17348.000000  17348.000000   
    mean      16.184286        29.709578      6.392668     11.098282   
    std        8.199274         9.629246      3.420806      6.728713   
    min        1.000000         2.000000      1.000000      1.000000   
    25%        9.000000        21.000000      3.000000      5.000000   
    50%       16.000000        34.000000      6.000000     11.000000   
    75%       23.000000        36.000000      9.000000     17.000000   
    max       31.000000        58.000000     12.000000     24.000000   

              record_id        weight          year  
sex                                                  
F   count  15690.000000  15303.000000  15690.000000  
    mean   18036.412046     42.170555   1990.644997  
    std    10423.089000     36.847958      7.598725  
    min        3.000000      4.000000   1977.000000  
    25%     8917.500000     20.000000   1984.000000  
    50%    18075.500000     34.000000   1990.000000  
    75%    27250.000000     46.000000   1997.000000  
    max    35547.000000    274.000000   2002.000000  
M   count  17348.000000  16879.000000  17348.000000  
    mean   17754.835601     42.995379   1990.480401  
    std    10132.203323     36.184981      7.403655  
    min        1.000000      4.000000   1977.000000  
    25%     8969.750000     20.000000   1984.000000  
    50%    17727.500000     39.000000   1990.000000  
    75%    26454.250000     49.000000   1997.000000  
    max    35548.000000    280.000000   2002.000000  
</code></pre></div></div>

<p>We can also get the mean for each numeric column, grouped by sex:</p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sorted_data.mean()
</code></pre></div></div>

<p><img src="../fig/group_mean_jn-table.png" alt="Means grouped by sex" /></p>

<!--~~~
        record_id     month        day         year    plot_id  \
sex                                                              
F    18036.412046  6.583047  16.007138  1990.644997  11.440854   
M    17754.835601  6.392668  16.184286  1990.480401  11.098282   

     hindfoot_length     weight  
sex                              
F          28.836780  42.170555  
M          29.709578  42.995379  

~~~
{: .output}
-->
<p>The <code class="highlighter-rouge">.groupby()</code> method is powerful in that it allows us to quickly generate
summaries of categorical data.</p>

<blockquote class="challenge">
  <h2 id="how-many-individuals-were-recorded-as-female-and-how-many-were-male">How many individuals were recorded as female and how many were male?</h2>

  <p>Using the <code class="highlighter-rouge">.describe()</code> method on the DataFrame sorted by sex, 
determine how many individuals were observed for each.</p>

  <blockquote class="solution">
    <h2 id="solution-1">Solution</h2>

    <ul>
      <li>
        <p><em>Female</em> = 15690</p>
      </li>
      <li>
        <p><em>Male</em> = 17348</p>
      </li>
    </ul>

  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="group-by-two-columns">Group by two columns</h2>

  <p>What happens when you group by two columns using the following syntax and 
then grab mean values:</p>
  <ul>
    <li>Hint: you can use a list in the arguments of the <code class="highlighter-rouge">.groupby()</code> method, <code class="highlighter-rouge">['plot_id','sex']</code></li>
  </ul>

  <blockquote class="solution">
    <h2 id="solution-2">Solution</h2>

    <div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sorted_data2 = surveys_df.groupby(['plot_id','sex'])
sorted_data2.mean()
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="summarize-a-single-column">Summarize a single column</h2>

  <p>Summarize weight values for each plot in your data.</p>

  <blockquote class="solution">
    <h2 id="solution-3">Solution</h2>

    <div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>by_plot = surveys_df.groupby('plot_id')
by_plot['weight'].describe()
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<h2 id="quickly-creating-summary-counts-in-pandas">Quickly Creating Summary Counts in Pandas</h2>

<p>Let’s next count the number of samples for each species. We can do this in a few
ways, but we’ll use <code class="highlighter-rouge">groupby</code> combined with a <code class="highlighter-rouge">count()</code> method.</p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>species_counts = surveys_df.groupby('species_id')['record_id'].count()
species_counts
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>species_id
AB      303
AH      437
AS        2
BA       46
CB       50
CM       13
CQ       16
...
</code></pre></div></div>

<p>Or, we can also count just the rows that have the species “PL” (<em>Peromyscus leucopus</em>):</p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>surveys_df.groupby('species_id')['record_id'].count()['PL']
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>36
</code></pre></div></div>

<h2 id="basic-math-functions">Basic Math Functions</h2>

<p>If we wanted to, we could perform math on an entire column of our data. For
example let’s multiply all weight values by 2. A more practical use of this might
be to normalize the data according to a mean, area, or some other value
calculated from our data.</p>

<p>Multiply all weight values by 2 and store values in a Pandas object called <code class="highlighter-rouge">double_weight</code>:</p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>double_weight = surveys_df['weight'] * 2
</code></pre></div></div>

<p>If we summarize <code class="highlighter-rouge">double_weight</code>, then the summary will indicate that these values are twice the original weights:</p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>double_weight.describe()
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>count    32283.000000
mean        85.344856
std         73.262519
min          8.000000
25%         40.000000
50%         74.000000
75%         96.000000
max        560.000000
Name: weight, dtype: float64
</code></pre></div></div>

<h1 id="quick--easy-plotting-using-pandas">Quick &amp; Easy Plotting Using Pandas</h1>

<p>We can plot our summary stats using Pandas, too. First, we must ensure that the plots will appear in our Jupyter notebook or IPython console (using Spyder):</p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>%matplotlib inline
</code></pre></div></div>

<p>Now, we can make a quick bar chart of the species counts</p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>species_counts.plot(kind='bar')
</code></pre></div></div>

<p><img src="../fig/species-counts-bar.png" alt="Weight by Species Plot" />
Number of individuals per species</p>

<p>We can also look at how many animals were captured in each plot:</p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>total_count = surveys_df.groupby('plot_id')['record_id'].nunique()
</code></pre></div></div>

<p>And plot a bar chart describing</p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>total_count.plot(kind='bar')
</code></pre></div></div>

<p><img src="../fig/num-captured.png" alt="Number Captured Plot" />
Number captured per plot</p>

<blockquote class="challenge">
  <h2 id="plot-the-average-weight-across-all-species-in-each-plot">Plot the average weight across all species in each plot</h2>

  <p>Create a bar plot that shows the average weight of all of the animals captured in that plot</p>

  <blockquote class="solution">
    <h2 id="solution-4">Solution</h2>

    <div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>plot_weight_means = surveys_df.groupby('plot_id')['weight'].mean()
plot_weight_means.plot(kind='bar')
</code></pre></div>    </div>

    <p><img src="../fig/plot_ave_weight.png" alt="Solution" /></p>
  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="plot-the-number-of-females-and-the-number-of-males-in-the-dataset">Plot the number of females and the number of males in the dataset</h2>

  <p>Create a bar plot that shows the total number of each sex captured for the entire dataset.</p>

  <blockquote class="solution">
    <h2 id="solution-5">Solution</h2>

    <div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>counts_by_sex = surveys_df['record_id'].groupby(surveys_df['sex']).count()
counts_by_sex.plot(kind='bar')
</code></pre></div>    </div>

    <p><img src="../fig/counts_by_sex.png" alt="Solution" /></p>
  </blockquote>
</blockquote>

<h1 id="more-fun-with-plotting">More Fun with Plotting</h1>

<p>Now we will plot something a little bit more difficult. We will use a stacked bar plot to show how both weight and sex are distributed across each plot in the study.</p>

<p>First we group data by plot and by sex, and then calculate a total for each plot.</p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>by_plot_sex = surveys_df.groupby(['plot_id','sex'])
plot_sex_count = by_plot_sex['weight'].sum()
plot_sex_count
</code></pre></div></div>

<p>This calculates the sums of weights for each sex within each plot as a table</p>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>plot  sex
plot_id  sex
1        F      38253
         M      59979
2        F      50144
         M      57250
3        F      27251
         M      28253
4        F      39796
         M      49377
...
</code></pre></div></div>

<p>Then we’ll use <code class="highlighter-rouge">.unstack()</code> on our grouped data to figure out the total weight that each sex contributed to each plot.</p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>plot_sex_count.unstack()
</code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sex            F        M
plot_id                  
1        38253.0  59979.0
2        50144.0  57250.0
3        27251.0  28253.0
4        39796.0  49377.0
5        21143.0  23326.0
6        26210.0  27245.0
7         6522.0   6422.0
...
</code></pre></div></div>

<p>Now, create a stacked bar plot with those data where the weights for each sex are stacked by plot.</p>

<div class="python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>spc = plot_sex_count.unstack()
s_plot = spc.plot(kind='bar',stacked=True,title="Total weight by plot and sex")
s_plot.set_ylabel("Weight")
s_plot.set_xlabel("Plot")
</code></pre></div></div>

<p><img src="../fig/stackedBar.png" alt="Stacked Bar Plot" /></p>

<ol class="bibliography"></ol>

<script type="text/javascript">
var _ol = document.querySelectorAll('ol');
for (var i = 0, elem_ol; elem_ol = _ol[i]; i++) {
	if ( elem_ol.classList == "bibliography" ) {
		var _li = elem_ol.getElementsByTagName("li");
		for (var j = 0, elem_li; elem_li = _li[j]; j++)
		{
			elem_li.innerHTML = elem_li.innerHTML.replace(/(https?:\/\/)([^\s<]+)/,"<a href=\"$1$2\">$2");
		}
		if(_li.length > 0)
			elem_ol.outerHTML = "<h2>References</h2>"+elem_ol.outerHTML
	}
}
</script>








  

  

  
    
    
  



  
  






<div class="row">
  <div class="col-md-1 no-print">
    <h3>
      
      <a href="/revbayes_tutorials/tutorials/more-dataframes/"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous tutorial</span></a>
      
    </h3>
  </div>
  <div class="col-md-10">
    
  </div>
  <div class="col-md-1 no-print">
    <h3>
      
      <a href="/revbayes_tutorials/"><span class="glyphicon glyphicon-menu-up" aria-hidden="true"></span><span class="sr-only">tutorials home</span></a>
      
    </h3>
  </div>
</div>


      <footer>
  <div class="row">
    <div class="col-md-6" align="left">
      <h5>
	Content adapted by Walker Pett</a>
      </h5>
    </div>
    <div class="col-md-6" align="right">
      <h5>
	<a href="<USERNAME>/<PROJECT>">Source</a>
	/
	<a href="mailto:willpett@iastate.edu">Contact</a>
      </h5>
    </div>
  </div>
</footer>

    </div>
    <script src="/revbayes_tutorials/assets/js/jquery.min.js"></script>
<script src="/revbayes_tutorials/assets/js/FileSaver.min.js"></script>
<script src="/revbayes_tutorials/assets/js/jszip.min.js"></script>
<script src="/revbayes_tutorials/assets/js/bootstrap.min.js"></script>
<script src="/revbayes_tutorials/assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      processEscapes: true
    }
  });
</script>
